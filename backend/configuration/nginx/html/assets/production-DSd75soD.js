import{j as r,al as T,y as M,u as B,r as c,z as b,B as L,T as O,H as A}from"./index-CRELzJTI.js";import{C as H}from"./config-global-D85ZwODf.js";import{C as N,S as v}from"./Card-Ci9vwztD.js";import{d as U,e as $,M as q}from"./main-zZCzAqhe.js";import{A as E,a as P}from"./Autocomplete-ViTGynXE.js";import{T as h}from"./TextField-DtVVHAoL.js";import{L as F}from"./LoadingButton-D4KKS1Ds.js";function R({posts:o,onSearch:n,onChange:s,product:t,error:l,sx:i}){return r.jsx(E,{autoHighlight:!0,fullWidth:!0,freeSolo:!0,onInputChange:n,value:t??"",popupIcon:null,slotProps:{paper:{sx:{[`& .${P.option}`]:{typography:"body2"},...i}}},options:o,getOptionLabel:e=>typeof e=="string"?e:e.name,isOptionEqualToValue:(e,d)=>e.name===d.name,renderInput:e=>r.jsx(h,{...e,name:"product",label:"ชื่อยา",placeholder:"Product name...",value:t??"",error:l,fullWidth:!0,onChange:s,InputLabelProps:{shrink:!0},sx:{mb:3}})})}function V({posts:o,onSearch:n,onChange:s,machine:t,error:l,sx:i}){return r.jsx(E,{autoHighlight:!0,fullWidth:!0,freeSolo:!0,onInputChange:n,value:t??"",popupIcon:null,slotProps:{paper:{sx:{[`& .${P.option}`]:{typography:"body2"},...i}}},options:o,getOptionLabel:e=>typeof e=="string"?e:e.machine,isOptionEqualToValue:(e,d)=>e.machine===d.machine,renderInput:e=>r.jsx(h,{...e,name:"machine",label:"เครื่องจักร",placeholder:"Machine...",value:t??"",error:l,fullWidth:!0,onChange:s,InputLabelProps:{shrink:!0},sx:{mb:3}})})}function G(){var x,g,_,D,j,y,C;const o=T(),n=M(),s=B(),t=K(),[l,i]=c.useState(!1),{row:e}=n.state||{},[d,I]=c.useState([]),[k,S]=c.useState([]),u=m=>{const{name:a,value:p}=m.target;t.setForm(a,p)},z=c.useCallback(()=>{console.log("Form Data before validation:",t.formData);const m={lot_number:t.formData.lot_number==="",product:t.formData.product==="",batch_size:t.formData.batch_size<=0,machine:t.formData.machine==="",start_product:t.formData.start_product==="",finish_product:t.formData.finish_product===""};t.setFormDataError(m),Object.values(m).some(p=>p)?console.log("Form submission failed, please correct the errors."):(async()=>{try{const f=await U(t.formData);o.back(),v.fire({icon:"success",title:"ดำเนินการเรียบร้อยแล้ว",text:"บันทึกรายการผลิตเรียบร้อยแล้ว",showConfirmButton:!1,timer:2e3})}catch(f){f.status===401||f.status===403?s("/sign-in"):(v.fire({icon:"error",title:"เกิดข้อผิดพลาด...",text:"ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้!, ลองไหม่อีกครั้ง",showCancelButton:!0,cancelButtonText:"ปิด"}),console.error("Error fetching data:",f))}})()},[t,o,s]),w=c.useCallback(()=>{o.back()},[o]);c.useEffect(()=>{l||((async()=>{try{const a=await $(),p=await q();I(a),S(p),console.log(p)}catch(a){console.error("Error fetching data:",a)}})(),e&&t.setFormData({id:e.id,timestamp:e.timestamp,lot_number:e.lot_number,product:e.product,batch_size:e.batch_size,machine:e.machine,start_product:b(e.start_product)??"",finish_product:b(e.finish_product)??"",notes:e.notes}),i(!0))},[e,t,l]);const W=r.jsxs(L,{display:"flex",flexDirection:"column",alignItems:"flex-end",children:[r.jsx(h,{name:"lot_number",label:"เลขที่ผลิต",placeholder:"Lot number...",value:((x=t.formData)==null?void 0:x.lot_number)??"",fullWidth:!0,onChange:u,error:t.formError.lot_number,InputLabelProps:{shrink:!0},sx:{mb:3}}),r.jsx(R,{posts:d,sx:{px:3},product:((g=t.formData)==null?void 0:g.product)??"",error:t.formError.product,onChange:u,onSearch:(m,a)=>{t.setForm("product",a)}}),r.jsx(h,{name:"batch_size",label:"ขนาดผลิต",placeholder:"Batch size...",type:"number",value:((_=t.formData)==null?void 0:_.batch_size)??0,error:t.formError.batch_size,fullWidth:!0,onChange:u,InputLabelProps:{shrink:!0},sx:{mb:3}}),r.jsx(V,{posts:k,sx:{px:3},machine:((D=t.formData)==null?void 0:D.machine)??"",error:t.formError.machine,onChange:u,onSearch:(m,a)=>{t.setForm("machine",a)}}),r.jsx(h,{name:"start_product",label:"วันที่เริ่มการผลิต",type:"datetime-local",value:b((j=t.formData)==null?void 0:j.start_product)??"",error:t.formError.start_product,fullWidth:!0,onChange:u,InputLabelProps:{shrink:!0},sx:{mb:3}}),r.jsx(h,{name:"finish_product",label:"วันที่จบการผลิต",type:"datetime-local",value:b((y=t.formData)==null?void 0:y.finish_product)??"",error:t.formError.finish_product,fullWidth:!0,onChange:u,InputLabelProps:{shrink:!0},sx:{mb:3}}),r.jsx(h,{name:"notes",label:"ลงบันทึกเพิ่มเติม",placeholder:"Note...",value:((C=t.formData)==null?void 0:C.notes)??"",fullWidth:!0,onChange:u,InputLabelProps:{shrink:!0},sx:{mb:3}}),r.jsx(F,{fullWidth:!0,sx:{mb:2},size:"large",type:"submit",color:"success",variant:"contained",onClick:z,children:"บันทึก"}),r.jsx(F,{fullWidth:!0,size:"large",type:"button",color:"error",variant:"contained",onClick:w,children:"ยกเลิก"})]});return r.jsx(r.Fragment,{children:r.jsxs(N,{sx:{mx:{xs:3,md:20},mb:5,px:{xs:1,md:8},py:5,boxShadow:"none",position:"relative",backgroundColor:"common.white"},children:[r.jsx(L,{gap:1.5,display:"flex",flexDirection:"column",alignItems:"center",mb:5,children:r.jsx(O,{variant:"h4",children:"แบบฟอร์มการผลิต"})}),W]})})}function K(){const[o,n]=c.useState({id:"",timestamp:"",lot_number:"",product:"",batch_size:0,machine:"",start_product:"",finish_product:"",notes:""}),[s,t]=c.useState({lot_number:!1,product:!1,batch_size:!1,machine:!1,start_product:!1,finish_product:!1});return{setForm:(i,e)=>{n({...o,[i]:e}),t({...s,[i]:!1})},formData:o,setFormData:n,formError:s,setFormDataError:t}}function rt(){return r.jsxs(r.Fragment,{children:[r.jsxs(A,{children:[r.jsxs("title",{children:[" ",`Production Form - ${H.appName}`]}),r.jsx("meta",{name:"description",content:"The starting point for your next project with Minimal UI Kit, built on the newest version of Material-UI ©, ready to be customized to your style"}),r.jsx("meta",{name:"keywords",content:"react,material,kit,application,dashboard,admin,template"})]}),r.jsx(G,{})]})}export{rt as default};
